(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{DD1Z:function(e,t,a){"use strict";var n=a("q1tI"),o=a.n(n),r=a("YFqc"),c=a.n(r),i=a("izhR"),s=a("nOHt"),l=a("8Kt/"),b=a.n(l),p=a("Ex07"),u=o.a.createElement,h=[{name:"Introduction",link:"/introduction"},{name:"Use Proxy",link:"/use-proxy"}],d=function(e,t){return e==="".concat("/docs").concat(t)};t.a=function(e){var t=e.children,a=Object(s.useRouter)();return u(p.a,null,u(b.a,null,u("title",null,"OasisDEX Protocol - Docs")),u(i.k,{my:[3,5]},u(i.q,{columns:[1,"200px 1fr"],sx:{alignItems:"flex-start"}},u(i.q,null,h.map((function(e,t){var n=e.name,o=e.link;return u(c.a,{href:"".concat("/docs").concat(o),key:t,passHref:!0},u(i.z,{sx:{p:0,color:d(a.pathname,o)?"primary":"text"}},n))}))),u(i.f,{sx:{"& > *:first-of-type":{mt:0}}},t))))}},Ff2n:function(e,t,a){"use strict";function n(e,t){if(null==e)return{};var a,n,o=function(e,t){if(null==e)return{};var a,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(o[a]=e[a]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(o[a]=e[a])}return o}a.d(t,"a",(function(){return n}))},HQsi:function(e,t,a){"use strict";a.r(t),a.d(t,"default",(function(){return p}));var n=a("wx14"),o=a("Ff2n"),r=a("q1tI"),c=a.n(r),i=a("7ljp"),s=a("DD1Z"),l=(c.a.createElement,{}),b="wrapper";function p(e){var t=e.components,a=Object(o.a)(e,["components"]);return Object(i.b)(b,Object(n.a)({},l,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)(s.a,{mdxType:"DocsLayout"},Object(i.b)("h1",{id:"how-to-use-oasis-direct-proxy-on-oasisdex-protocol"},"How to use Oasis Direct Proxy on OasisDEX Protocol"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Level:")," Intermediate",Object(i.b)("br",{parentName:"p"}),"\n",Object(i.b)("strong",{parentName:"p"},"Estimated Time:")," 30 minutes"),Object(i.b)("h1",{id:"overview"},"Overview"),Object(i.b)("p",null,"Trading on decentralized marketplaces involves signing multiple transactions with your wallet. This leads to having higher chances of having failed transactions. Using a proxy simplifies this process by combining many transactions into one."),Object(i.b)("p",null,"This guide will show you how to make trades on the OasisDEX Protocol through the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy"}),"Oasis Direct Proxy"),". The Oasis Direct Proxy allows you to bundle together many function calls into a single transaction. So, when you have to trade some ERC-20 tokens, you will be able to do it all in one transaction."),Object(i.b)("p",null,"This can be done through the DS-Proxy contract, which is a generic mechanism that allows for bundling transactions and having allowances setup once for different contracts, or by creating your own proxy contract that can interact with the Oasis Direct Proxy contract. Another example of a proxy contract is the one created by ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://instadapp.io/"}),"https://instadapp.io/"),", which interacts with many services."),Object(i.b)("p",null,"Using a proxy contract is beneficial for you as a user or as a developer that wants to build DApps. The most obvious use case is the front-end applications that interact with the protocol. A good example is the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://oasis.app/"}),"oasis.app")," and the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/makerdao/dai.js"}),"Dai.js SDK"),"."),Object(i.b)("h1",{id:"learning-objectives"},"Learning Objectives"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Learn about the Oasis Direct Proxy functions")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Learn how to use the Oasis Direct Proxy on the OasisDEX Protocol"))),Object(i.b)("h1",{id:"pre-requisites"},"Pre-requisites"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/dapphub/dapptools/tree/master/src/seth#installing"}),"Seth tools")," - command line tool to interact with the ethereum network")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/makerdao/developerguides/blob/master/devtools/working-with-dsproxy/working-with-dsproxy.md"}),"Understand how a DSProxy works"))),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"/docs/introduction"}),"Understand the OasisDEX protocol")))),Object(i.b)("h1",{id:"sections"},"Sections"),Object(i.b)("p",null,"This guide will demonstrate how to use the Oasis Direct Proxy functions available on the GitHub repository ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy"}),"here"),". If you also want to learn the extra details of each function, please also read the README from the mentioned repository."),Object(i.b)("p",null,"This guide works with the MCD Dai ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://changelog.makerdao.com/releases/kovan/0.2.17/contracts.json"}),"0.2.17 Kovan Release"),". Here you will find all the necessary contract addresses."),Object(i.b)("h2",{id:"set-up-contract-addresses-in-your-terminal"},"Set up contract addresses in your terminal"),Object(i.b)("p",null,"Export the below environmental variables in your terminal:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"export PROXY_REGISTRY=0x64a436ae831c1672ae81f674cab8b6775df3475c\nexport OASIS_DIRECT_PROXY=0xEE419971E63734Fed782Cfe49110b1544ae8a773\nexport WETH=0xd0a1e359811322d97991e03f863a0c30c2cf029c\nexport DAI=0x4f96fe3b7a6cf9725f59d353f723c1bdb64ca6aa\nexport OTC=0x4A6bC4e803c62081ffEbCc8d227B5a87a58f1F8F\nexport ETH_GAS=4000000\nexport ETH_GAS_PRICE=2500000000\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Proxy Registry")," - Is a map of proxy contracts and their owner addresses. Here you can check if you have a proxy"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Oasis Direct Proxy")," - This is a contract with all the available functions that can be used to make a trade on the OasisDEX protocol."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"WETH")," - Is the wrapped Ether contract that turns ETH into and ERC-20 compatible token."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"DAI")," - Is the Multi-Collateral Dai token address from the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://changelog.makerdao.com/releases/kovan/0.2.17/contracts.json"}),"0.2.17 Kovan Deployment")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"OTC")," - Is the OasisDEX protocol contract address"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"ETH Gas")," - Is the the gas limit"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"ETH Gas Price")," - Is the gas price"),Object(i.b)("h2",{id:"setting-up-or-retrieve-your-proxy-contract"},"Setting up or retrieve your proxy contract"),Object(i.b)("p",null,"There are many ways to interact with the Oasis Direct Proxy contract. You can:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Directly call functions in the Oasis Direct Proxy")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Set up a proxy contract that would call functions on your behalf when interacting with the Oasis Direct contract"))),Object(i.b)("p",null,"If you choose to interact directly with the Oasis Direct Proxy, then you\u2019ll have to give allowance to this contract.",Object(i.b)("br",{parentName:"p"}),"\n","If you choose to use DS-Proxy, then you give allowance only once and this contract can interact with any other proxy actions contract without having to give allowance again."),Object(i.b)("p",null,"In this guide, we\u2019ll use the DS-Proxy contract as your proxy that will interact with the Oasis Direct Proxy contract."),Object(i.b)("p",null,"First you need to set up a DSProxy contract for your wallet. Or retrieve the address if you already have one."),Object(i.b)("p",null,"Execute the command below to verify if you have a proxy contract:"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"seth call $PROXY_REGISTRY 'proxies(address)(address)' $ETH_FROM")),Object(i.b)("p",null,"If the output is an address (for instance"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"3704fa2f6234ad5f2da063121496003e999c5312\n")),Object(i.b)("p",null,"), then this address is your proxy contract. If you get an output like this:"),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"\n0000000000000000000000000000000000000000\n\n")),Object(i.b)("p",null,"then you don\u2019t have one."),Object(i.b)("p",null,"In case you don\u2019t have the proxy contract, you can set it up through the below command:"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"seth send $PROXY_REGISTRY 'build()'")),Object(i.b)("p",null,"Now to see your proxy contract address, execute the above command that verifies if you have a proxy address. After executing it. Store your proxy address in an env variable."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"export MYPROXY=$(seth call $PROXY_REGISTRY 'proxies(address)(address)' $ETH_FROM)")),Object(i.b)("h2",{id:"oasis-direct-proxy-functions"},"Oasis Direct Proxy Functions"),Object(i.b)("p",null,"These functions are used to make instant market orders on the marketplace. If you want to see a frontend example, check out the instant page on ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://oasis.app/trade/instant"}),"oasis.app/trade/instant"),". If you want to make a simple limit order, then check the OasisDEX protocol ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/maker-otc"}),"contract"),"."),Object(i.b)("p",null,"The Oasis Direct Proxy covers 6 functions that you could use. These are:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L27"}),"sellAllAmount")," - Triggering an ERC-20 for ERC-20 trade")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L36"}),"sellAllAmountPayEth")," - Triggering an ETH for ERC-20 token trade")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L45"}),"sellAllAmountBuyEth")," - Triggering an ERC-20 for ETH trade")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L54"}),"buyAllAmount")," - Triggering an ERC-20 for ERC-20 trade")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L65"}),"buyAllAmountPayEth")," - Triggering an ETH for ERC-20 token trade")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy/blob/321f63bb33fb534c490e8c56680daeab10608bc1/src/OasisDirectProxy.sol#L76"}),"buyAllAmountBuyEth")," - Triggering an ERC-20 for ETH trade"))),Object(i.b)("p",null,"If you want to understand each function in more detail, please do read the provided ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy"}),"README"),". For example, if you want to sell exactly 10 BAT for some amount of ETH, you can use sellAllAmountBuyEth(). If you want to sell at least 10 ZRX for some specified amount of DAI, you can use buyAllAmount() as you will be buying specific amount of DAI, paying for it with ZRX."),Object(i.b)("p",null,"These functions will wrap/unwrap ETH (if necessary), check the on-chain liquidity (using getBuyAmount() and getPayAmount() OTC methods) and finally call OTC\u2019s buyAllAmount/sellAllAmount() methods if the liquidity and price is within user\u2019s supplied limits."),Object(i.b)("p",null,"In addition, you will have to give allowance to the tokens you want to trade to the DS-Proxy contract in order for the trades to succeed. This is due to the majority of functions having a ",Object(i.b)("inlineCode",{parentName:"p"},"pull")," of funds method from your wallet in order to carry the trade."),Object(i.b)("p",null,"So, in the case that you want to sell Dai or WETH, you will have to approve the tokens to DS-Proxy.",Object(i.b)("br",{parentName:"p"}),"\n","Below is an example of how to do it:"),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Approve Dai in MYPROXY:")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"seth send $DAI 'approve(address,uint256)' $MYPROXY $(seth --to-bytes32 $(mcd --to-hex -1))")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Approve WETH in MYPROXY:")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"seth send $WETH 'approve(address,uint256)' $MYPROXY $(seth --to-bytes32 $(mcd --to-hex -1))")),Object(i.b)("p",null,"With DS-Proxy you only have to approve the token contracts once in order to carry as many trades as you want. This is the benefit of using such contract."),Object(i.b)("h2",{id:"making-a-trade"},"Making a trade"),Object(i.b)("p",null,"Note: Check the liquidity on the ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://oasis.app/trade"}),"(e.g. here)")," on the Kovan network before doing any function calls. If there is no liquidity, then you will have failed transactions."),Object(i.b)("p",null,"Let\u2019s assume we want to buy exactly 3 Dai on the Oasis protocol. In order to process this trade, we can use the buyAllAmountPayEth function. In this function, we specify the exact amount of Dai we want to receive and send an approximate amount of ETH. Given that this function does not \u201cpull\u201d any tokens from your wallet, no additional token approval is necessary."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"buyAllAmountPayEth")," function parameters are these:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"OasisDEX address (OTC)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"DAI token address (DAI)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"buyAmt (uint256) - the amount that will be purchased")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"wethToken (address) - address of WETH token"))),Object(i.b)("h3",{id:"creating-the-calldata"},"Creating the calldata"),Object(i.b)("p",null,"Before executing the function to the proxy contract, you need to build the calldata with the function name and all its parameters. You can export all this calldata to an environment variable in the terminal."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Set the buyAmt parameter to 3 Dai:")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"export buyAmt=$(seth --to-uint256 $(seth --to-wei 3 eth))")),Object(i.b)("p",null,"\u2018eth\u2019 in the ",Object(i.b)("inlineCode",{parentName:"p"},"seth --to-wei 3 eth")," command refers to the ETH conversion unit. It adds 18 zeros to 3. Converting it to the wei format."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Set the calldata:")),Object(i.b)("pre",null,Object(i.b)("code",Object(n.a)({parentName:"pre"},{}),"export calldata=$(seth calldata 'buyAllAmountPayEth(address,address,uint,address)' $OTC $DAI $buyAmt $WETH)\n")),Object(i.b)("h3",{id:"executing-the-function"},"Executing the function"),Object(i.b)("p",null,"To execute the ",Object(i.b)("strong",{parentName:"p"},"buyAllAmountPayEth")," function, you need to send a transaction to your proxy contract by calling the execute function and adding the Oasis Direct Proxy contract address and calldata as parameters. Depending on the function, you might send ETH as well. In our case, you are sending 0.05 ETH to the contract for purchasing Dai."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"seth send $MYPROXY 'execute(address, bytes memory)' $OASIS_DIRECT_PROXY $calldata --value $(seth --to-wei 0.05 eth)")),Object(i.b)("p",null,Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://kovan.etherscan.io/tx/0xd24d388f61b86d3a726df99231d71fae94e0b7c711a43b5f963ada5ba73cba6b"}),"This")," is an example of a successful transaction.",Object(i.b)("br",{parentName:"p"}),"\n","If you look closely, you\u2019ll notice that that the user sent more ETH than was necessary to the marketplace. For getting 3 Dai he paid 0.037974683544303797 ETH and the rest was returned back to his wallet. This is special to this marketplace function. You define the exact number of Dai you want to receive. Depending on the market liquidity, you might spend more or less ETH for the Dai. So, in your case he bought Dai at the ~ 79 ETH/DAI price."),Object(i.b)("p",null,"As you observed, all this has been done through one transaction on the Ethereum blockchain. This leads to improved UX, and less transactions."),Object(i.b)("p",null,"So, in order to interact with the OasisDEX protocol through the Oasis Direct Proxy functions you need to have your proxy contract setup through the proxy registry and execute the specific calldata according to your requirements."),Object(i.b)("h1",{id:"summary"},"Summary"),Object(i.b)("p",null,"In this guide you have learned how to use your proxy contract to execute Oasis Direct Proxy actions on the OasisDEX protocol. Using a proxy contract can be beneficial for both the users and developers by limiting the amount of needed transactions, which results in a more seamless UX."),Object(i.b)("h1",{id:"additional-resources"},"Additional Resources"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Make sure to read the Oasis Direct Proxy Actions github ",Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/oasis-direct-proxy"}),"repo"),", as it explains in detail every function call.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},Object(i.b)("a",Object(n.a)({parentName:"p"},{href:"https://github.com/daifoundation/maker-otc"}),"OasisDEX Protocol")))),Object(i.b)("h1",{id:"help"},"Help"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"If you need help, reach out to the OasisDEX Protocol community. One of the popular places where many discussions take place is the #dev channel at ",Object(i.b)("a",Object(n.a)({parentName:"li"},{href:"https://chat.makerdao.com/channel/dev"}),"https://chat.makerdao.com/channel/dev")))))}p.isMDXComponent=!0},fQlj:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/docs/use-proxy",function(){return a("HQsi")}])}},[["fQlj",0,2,1,3,4]]]);